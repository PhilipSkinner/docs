{
  "openapi": "3.0.0",
  "info": {
    "title": "Guarantees API",
    "version": "1.0",
    "contact": {
      "name": "Philip Skinner",
      "email": "philip.skinner@cds.co.uk"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000"
    }
  ],
  "paths": {
    "/guarantees": {
      "parameters": [],
      "get": {
        "summary": "Get guarantees",
        "tags": [
          "Guarantees"
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "meta": {
                      "$ref": "../models/paginationMeta.v1.json"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/guaranteeResponse"
                      }
                    },
                    "links": {
                      "$ref": "../models/paginationLinks.v1.json"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "operationId": "get-lender-lenderId-guarantees",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "startdate"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "enddate"
          }
        ],
        "description": "Fetches a paginated list of guarantees.\n\nRequires the guarantee_reader role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ]
      },
      "post": {
        "summary": "Create a guarantee",
        "operationId": "post-lender-lenderId-guarantees",
        "responses": {
          "201": {
            "description": "Created",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              },
              "Location": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "tags": [
          "Guarantees"
        ],
        "description": "Creates a guarantee.\n\nRequires the guarantee_writer role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/guaranteeAttributes"
              }
            }
          }
        }
      }
    },
    "/guarantees/{guaranteeId}": {
      "parameters": [
        {
          "schema": {
            "type": "string"
          },
          "name": "guaranteeId",
          "in": "path",
          "required": true
        }
      ],
      "get": {
        "summary": "Get a guarantee",
        "tags": [
          "Guarantees"
        ],
        "responses": {
          "200": {
            "description": "OK",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "operationId": "get-lender-lenderId-guarantees-guaranteeId",
        "description": "Fetch a single guarantee.\n\nRequires the guarantee_reader role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ]
      },
      "put": {
        "summary": "Update guarantee",
        "operationId": "put-lender-lenderId-guarantees-guaranteeId",
        "responses": {
          "202": {
            "description": "Accepted",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "description": "Update a guarantee.\n\nRequires the guarantee_writer role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/guaranteeAttributes"
              }
            }
          }
        },
        "tags": [
          "Guarantees"
        ]
      },
      "patch": {
        "summary": "Partially update a guarantee",
        "operationId": "patch-lender-lenderId-guarantees-guaranteeId",
        "responses": {
          "202": {
            "description": "Accepted",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "description": "Update a guarantee only with the values provided in the body.\n\nRequires the guarantee_writer role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/guaranteeAttributes"
              }
            }
          }
        },
        "tags": [
          "Guarantees"
        ]
      },
      "delete": {
        "summary": "Delete a guarantee",
        "operationId": "delete-lender-lenderId-guarantees-guaranteeId",
        "responses": {
          "204": {
            "description": "No Content"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "description": "Delete a guarantee.\n\nRequires the guarantee_remover role to access.",
        "tags": [
          "Guarantees"
        ],
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "guarantee": {
        "title": "guarantee",
        "type": "object",
        "properties": {
          "meta": {
            "$ref": "../models/individualMeta.v1.json"
          },
          "data": {
            "$ref": "#/components/schemas/guaranteeResponse"
          },
          "links": {
            "type": "object",
            "properties": {
              "self": {
                "type": "string"
              }
            }
          }
        },
        "x-tags": [
          "Misc Models"
        ]
      },
      "guaranteeResponse": {
        "title": "guaranteeResponse",
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "etag": {
            "type": "string"
          },
          "attributes": {
            "$ref": "#/components/schemas/guaranteeAttributes"
          }
        },
        "x-tags": [
          "Misc Models"
        ]
      },
      "guaranteeAttributes": {
        "title": "guaranteeAttributes",
        "type": "object",
        "x-tags": [
          "Guarantees"
        ],
        "description": "",
        "properties": {
          "createdBy": {
            "type": "string"
          },
          "createdDate": {
            "type": "string"
          },
          "updatedBy": {
            "type": "string"
          },
          "updatedDate": {
            "type": "string"
          },
          "dataProtectionAgreed": {
            "type": "boolean"
          },
          "facilityDetails": {
            "type": "object",
            "properties": {
              "product": {
                "$ref": "../models/objectPointer.v1.json"
              },
              "facilityType": {
                "type": "string",
                "enum": [
                  "Term Loan",
                  "Asset Finance",
                  "Invoice Finance",
                  "Revolving Credit"
                ]
              },
              "repaymentType": {
                "type": "object",
                "properties": {
                  "paymentType": {
                    "type": "string",
                    "enum": [
                      "Amount",
                      "Term"
                    ]
                  },
                  "fixedRepaymentAmount": {
                    "type": "number"
                  },
                  "term": {
                    "type": "object",
                    "properties": {
                      "years": {
                        "type": "number",
                        "minimum": 0
                      },
                      "months": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 11
                      }
                    }
                  },
                  "paymentFrequency": {
                    "type": "string",
                    "enum": [
                      "Annually",
                      "6-monthly",
                      "Quarterly",
                      "Monthly",
                      "Weekly",
                      "Seasonal",
                      "Bullet - Interest only"
                    ]
                  },
                  "seasonalMonths": {
                    "type": "array",
                    "items": {}
                  }
                }
              },
              "principalPurpose": {
                "type": "string",
                "enum": [
                  "Start-up costs",
                  "General working capital requirements",
                  "Purchasing specific equipment or machinery",
                  "Purchasing licences quotas or other entitlements to trade",
                  "Research and Development activities",
                  "Acquiring another business within the UK",
                  "Acquiring another business outside the UK - Ineligible",
                  "Expanding an existing business within the UK",
                  "Expanding an existing business outside the UK - Ineligible",
                  "Financing an export order - Ineligible",
                  "Replacing existing internal finance",
                  "Replacing existing external finance"
                ]
              },
              "facilityTotalAmount": {
                "type": "number"
              },
              "interest": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "Variable",
                      "Fixed"
                    ]
                  },
                  "rateMargin": {
                    "type": "number",
                    "minimum": 0
                  }
                }
              },
              "assetFinanceDetails": {
                "type": "object",
                "properties": {
                  "balloonAmount": {
                    "type": "number"
                  },
                  "details": {
                    "type": "object",
                    "properties": {
                      "category": {
                        "type": "string",
                        "enum": [
                          "Furniture and fittings",
                          "Cars / taxis",
                          "Construction equipment (incl scaffolding, portacabins)",
                          "Light commercial vehicles",
                          "Materials handling",
                          "Garage equipment",
                          "Engineering equipment",
                          "Refrigeration",
                          "Catering / cleaning",
                          "Hair and beauty equipment",
                          "Agricultural / Farming / Livestock",
                          "Gymnasium / Sports / Leisure equipment",
                          "Vending equipment",
                          "Heavy commercial vehicles / Trailers",
                          "Buses / Coaches",
                          "Cranes",
                          "Industrial Plant and Machinery",
                          "Computer Equipment / Technology / Telecoms (hardware / software)",
                          "Dental / Medical / Optical Equipment / Scientific/ Health / Veterinary",
                          "Broadcast and Media equipment",
                          "Printing Equipment and Reprography",
                          "Other"
                        ]
                      },
                      "cashPrice": {
                        "type": "number"
                      },
                      "installCost": {
                        "type": "number"
                      },
                      "deposit": {
                        "type": "number"
                      },
                      "partExchange": {
                        "type": "number"
                      },
                      "originalBalance": {
                        "type": "number"
                      },
                      "residualValue": {
                        "type": "number"
                      },
                      "coverPercent": {
                        "type": "number"
                      },
                      "totalGuaranteesFacilityAmount": {
                        "type": "number"
                      }
                    },
                    "required": [
                      "category",
                      "cashPrice",
                      "installCost",
                      "deposit",
                      "partExchange",
                      "residualValue",
                      "coverPercent"
                    ]
                  },
                  "agreementType": {
                    "type": "string",
                    "enum": [
                      "Hiring Purchase",
                      "Finance Lease",
                      "Sale and LeaseBack"
                    ]
                  }
                }
              }
            }
          },
          "lender": {
            "$ref": "../models/objectPointer.v1.json"
          },
          "applicationDetails": {
            "type": "object",
            "properties": {
              "legalForm": {
                "type": "string",
                "enum": [
                  "Limited Liability Partnership (LLP)",
                  "Private Limited Company (LTD)",
                  "Public Limited Company (PLC)"
                ]
              },
              "companyRegistrationNumber": {
                "type": "string"
              },
              "businessLegalName": {
                "type": "string"
              },
              "businessTradingName": {
                "type": "string"
              },
              "sicCode": {
                "type": "string"
              },
              "companyTurnover": {
                "type": "number"
              },
              "turnoverAboveFiftyPercent": {
                "type": "boolean"
              },
              "tradingStartDate": {
                "type": "string"
              },
              "tradingPostcode": {
                "type": "string"
              }
            }
          },
          "predictedDrawDowns": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/drawDown"
            }
          },
          "drawDowns": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/drawDown"
            }
          },
          "repaymentHolidays": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "startDate": {
                  "type": "string"
                },
                "endDate": {
                  "type": "string"
                }
              }
            }
          },
          "stateAid": {
            "type": "object",
            "properties": {
              "calculatedAmount": {
                "type": "number"
              },
              "applicantMinimusStateAidPastThreeYears": {
                "type": "boolean"
              }
            }
          },
          "feesAndSecurity": {
            "type": "object",
            "properties": {
              "totalVaue": {
                "type": "number"
              },
              "security": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "additionalSecurityValue": {
                      "type": "number"
                    },
                    "principalTypeofAsset": {
                      "type": "number"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "drawDown": {
        "title": "drawDown",
        "type": "object",
        "properties": {
          "date": {
            "type": "string"
          },
          "amount": {
            "type": "number"
          }
        }
      }
    },
    "securitySchemes": {
      "Bearer token": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  },
  "tags": [
    {
      "name": "Guarantees"
    },
    {
      "name": "Demands"
    }
  ]
}