{
  "openapi": "3.0.0",
  "info": {
    "title": "Guarantees API",
    "version": "1.0",
    "contact": {
      "name": "Philip Skinner",
      "email": "philip.skinner@cds.co.uk"
    },
    "description": "Manages the lifecycle of guarantees."
  },
  "servers": [
    {
      "url": "http://localhost:3000"
    }
  ],
  "paths": {
    "/guarantees": {
      "get": {
        "summary": "Get guarantees",
        "tags": [
          "Guarantees"
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "meta": {
                      "$ref": "../models/paginationMeta.v1.json"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/guaranteeData"
                      }
                    },
                    "links": {
                      "$ref": "../models/paginationLinks.v1.json"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "operationId": "get-lender-lenderId-guarantees",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "startdate"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "enddate"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "page"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "pagesize",
            "description": "Set to -1 to retrieve all items."
          }
        ],
        "description": "Fetches a paginated list of guarantees.\n\nRequires the guarantee_reader role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ]
      },
      "post": {
        "summary": "Create a guarantee",
        "operationId": "post-guarantees",
        "responses": {
          "201": {
            "description": "Created",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              },
              "Location": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "tags": [
          "Guarantees"
        ],
        "description": "Creates a guarantee.\n\nRequires the guarantee_writer role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/guarantee"
              }
            }
          }
        }
      }
    },
    "/guarantees/{guaranteeId}": {
      "parameters": [
        {
          "schema": {
            "type": "string"
          },
          "name": "guaranteeId",
          "in": "path",
          "required": true
        }
      ],
      "get": {
        "summary": "Get a guarantee",
        "tags": [
          "Guarantees"
        ],
        "responses": {
          "200": {
            "description": "OK",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "304": {
            "description": "Not Modified"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "operationId": "get-lender-lenderId-guarantees-guaranteeId",
        "description": "Fetch a single guarantee.\n\nRequires the guarantee_reader role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ]
      },
      "put": {
        "summary": "Update guarantee",
        "operationId": "put-lender-lenderId-guarantees-guaranteeId",
        "responses": {
          "202": {
            "description": "Accepted",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "description": "Update a guarantee.\n\nRequires the guarantee_writer role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/guarantee"
              }
            }
          }
        },
        "tags": [
          "Guarantees"
        ]
      },
      "patch": {
        "summary": "Partially update a guarantee",
        "operationId": "patch-lender-lenderId-guarantees-guaranteeId",
        "responses": {
          "202": {
            "description": "Accepted",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "description": "Update a guarantee only with the values provided in the body.\n\nRequires the guarantee_writer role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/guarantee"
              }
            }
          }
        },
        "tags": [
          "Guarantees"
        ]
      },
      "delete": {
        "summary": "Delete a guarantee",
        "operationId": "delete-lender-lenderId-guarantees-guaranteeId",
        "responses": {
          "204": {
            "description": "No Content"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "description": "Delete a guarantee.\n\nRequires the guarantee_remover role to access.",
        "tags": [
          "Guarantees"
        ],
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ]
      }
    },
    "/guarantee/{guaranteeId}/inLifeEvents": {
      "parameters": [
        {
          "schema": {
            "type": "string"
          },
          "name": "guaranteeId",
          "in": "path",
          "required": true
        }
      ],
      "post": {
        "summary": "In Life Events",
        "operationId": "post-guarantee-guaranteeId-inLifeEvents",
        "responses": {
          "202": {
            "description": "Accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/inLifeEvent"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden"
          },
          "412": {
            "description": "Precondition Failed"
          },
          "422": {
            "description": "Unprocessable Entity (WebDAV)"
          }
        },
        "tags": [
          "Guarantees"
        ],
        "description": "This endpoint allows the client to try changes before comitting them to guarantee. Changes will be validated and returned with any errors. Clients should not comit changes to the guarantee resource until the in life event response returns no errors. In life events are not currently saved.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/inLifeEvent"
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "guarantee": {
        "title": "guarantee",
        "type": "object",
        "x-tags": [
          "Misc Models"
        ],
        "properties": {
          "meta": {
            "$ref": "../models/individualMeta.v1.json"
          },
          "data": {
            "$ref": "#/components/schemas/guaranteeData"
          },
          "links": {
            "type": "object",
            "properties": {
              "guarantees": {
                "type": "string",
                "format": "uri"
              },
              "products": {
                "type": "string"
              }
            }
          },
          "errors": {
            "type": "array",
            "items": {
              "$ref": "../models/error.v1.json"
            }
          }
        }
      },
      "guaranteeData": {
        "title": "guaranteeData",
        "type": "object",
        "x-tags": [
          "Misc Models"
        ],
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "links": {
            "type": "object",
            "properties": {
              "inLifeEvents": {
                "type": "string",
                "format": "uri"
              },
              "self": {
                "type": "string",
                "format": "uri"
              }
            }
          },
          "relationships": {
            "type": "object",
            "properties": {
              "feePaymentProfile": {
                "type": "object",
                "format": "uri",
                "properties": {
                  "links": {
                    "type": "object",
                    "properties": {
                      "self": {
                        "type": "string",
                        "format": "uri"
                      }
                    }
                  }
                }
              },
              "documents": {
                "type": "object",
                "properties": {
                  "links": {
                    "type": "object",
                    "properties": {
                      "offerDocuments": {
                        "type": "string",
                        "format": "uri"
                      },
                      "feePaymentScheduleDocument": {
                        "type": "string",
                        "format": "uri"
                      }
                    }
                  }
                }
              },
              "productUsed": {
                "type": "object",
                "properties": {
                  "links": {
                    "type": "object",
                    "properties": {
                      "product": {
                        "type": "string",
                        "format": "uri"
                      }
                    }
                  }
                }
              },
              "ruleSetUsed": {
                "type": "object",
                "properties": {
                  "links": {
                    "type": "object",
                    "properties": {
                      "ruleSet": {
                        "type": "string",
                        "format": "uri"
                      }
                    }
                  }
                }
              },
              "lender": {
                "type": "object",
                "properties": {
                  "links": {
                    "type": "object",
                    "properties": {
                      "self": {
                        "type": "string",
                        "format": "uri"
                      }
                    }
                  }
                }
              },
              "directDebitMandate": {
                "type": "object",
                "properties": {
                  "links": {
                    "type": "object",
                    "properties": {
                      "mandate": {
                        "type": "string",
                        "format": "uri"
                      }
                    }
                  }
                }
              }
            }
          },
          "attributes": {
            "$ref": "#/components/schemas/guaranteeAttributes"
          },
          "etag": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": [
              "guarantee"
            ]
          }
        }
      },
      "drawDown": {
        "title": "drawDown",
        "type": "object",
        "properties": {
          "date": {
            "type": "string",
            "format": "date"
          },
          "amount": {
            "type": "integer"
          },
          "monthsFromStart": {
            "type": "number"
          }
        },
        "required": [
          "date",
          "amount"
        ]
      },
      "inLifeEvent": {
        "title": "inLifeEvent",
        "type": "object",
        "x-tags": [
          "Misc Models"
        ],
        "description": "represents the potential guarantee message response to an in life event change on a guarantee.",
        "properties": {
          "errors": {
            "type": "array",
            "items": {
              "$ref": "../models/error.v1.json"
            }
          },
          "links": {
            "type": "object",
            "properties": {
              "self": {
                "type": "string",
                "format": "uri"
              },
              "guarantees": {
                "type": "string",
                "format": "uri"
              },
              "inLifeEvent": {
                "type": "string",
                "format": "uri"
              },
              "currentGuarantee": {
                "type": "string",
                "format": "uri"
              }
            }
          },
          "data": {
            "$ref": "#/components/schemas/guaranteeData"
          },
          "meta": {
            "$ref": "../models/individualMeta.v1.json"
          }
        }
      },
      "guaranteeAttributes": {
        "title": "guaranteeAttributes",
        "type": "object",
        "x-tags": [
          "Guarantees"
        ],
        "description": "",
        "properties": {
          "createdBy": {
            "type": "string",
            "description": "Not to be sent in POST/PUT/PATCH."
          },
          "createdDate": {
            "type": "string",
            "format": "date-time",
            "description": "Not to be sent in POST/PUT/PATCH."
          },
          "updatedBy": {
            "type": "string",
            "description": "Not to be sent in POST/PUT/PATCH."
          },
          "updatedDate": {
            "type": "string",
            "format": "date-time",
            "description": "Not to be sent in POST/PUT/PATCH."
          },
          "facilityDetails": {
            "type": "object",
            "properties": {
              "facilityType": {
                "type": "string"
              },
              "assetFinanceDetails": {
                "type": "object",
                "properties": {
                  "balloonAmount": {
                    "type": "number"
                  },
                  "details": {
                    "type": "object",
                    "properties": {
                      "category": {
                        "type": "string"
                      },
                      "cashPrice": {
                        "type": "number"
                      },
                      "installCost": {
                        "type": "number"
                      },
                      "deposit": {
                        "type": "number"
                      },
                      "partExchange": {
                        "type": "number"
                      },
                      "originalBalance": {
                        "type": "number"
                      },
                      "residualValue": {
                        "type": "number"
                      },
                      "coverPercent": {
                        "type": "number"
                      },
                      "totalGuaranteeFacilityAmount": {
                        "type": "number"
                      }
                    },
                    "required": [
                      "category",
                      "cashPrice",
                      "installCost",
                      "deposit",
                      "partExchange",
                      "residualValue",
                      "coverPercent"
                    ]
                  },
                  "agreementType": {
                    "type": "string"
                  },
                  "netYieldPercent": {
                    "type": "number"
                  }
                }
              },
              "invoiceFinance": {
                "type": "object",
                "properties": {
                  "grossBookDebt": {
                    "type": "number"
                  },
                  "supportedLimit": {
                    "type": "number"
                  },
                  "guaranteePrePaymentAmount": {
                    "type": "number"
                  }
                }
              },
              "revolvingCredit": {
                "type": "object",
                "properties": {
                  "overDraft": {
                    "type": "boolean"
                  },
                  "existingFacilityLimit": {
                    "type": "number"
                  },
                  "efgValue": {
                    "type": "number"
                  }
                }
              },
              "interest": {
                "type": "object",
                "properties": {
                  "interestType": {
                    "type": "string",
                    "enum": [
                      "fixed",
                      "variable"
                    ]
                  },
                  "rateMargin": {
                    "type": "number"
                  }
                }
              },
              "facilityTotalAmount": {
                "type": "number"
              },
              "principalPurpose": {
                "type": "string"
              },
              "repaymentType": {
                "type": "string"
              },
              "paymentFrequency": {
                "type": "string"
              },
              "seasonalMonths": {
                "type": "array",
                "enum": [
                  "1",
                  "2",
                  "3",
                  "4",
                  "5",
                  "6",
                  "7",
                  "8",
                  "9",
                  "10",
                  "11",
                  "12"
                ],
                "items": {
                  "type": "integer"
                }
              },
              "term": {
                "type": "object",
                "properties": {
                  "years": {
                    "type": "integer"
                  },
                  "months": {
                    "type": "integer"
                  },
                  "totalMonths": {
                    "type": "integer"
                  },
                  "startDate": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Calculated based on first drawdown or today + 1 day if no drawdown present."
                  },
                  "maturityDate": {
                    "type": "string",
                    "format": "date-time",
                    "description": "calculated based on startDate + term.totalMonths"
                  }
                }
              },
              "frequencyPaymentAmount": {
                "type": "number"
              },
              "repayments": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "date": {
                      "type": "string",
                      "format": "date"
                    },
                    "amount": {
                      "type": "number"
                    },
                    "balance": {
                      "type": "number"
                    }
                  }
                }
              },
              "expectedRepayments": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "date": {
                      "type": "string",
                      "format": "date"
                    },
                    "amount": {
                      "type": "number"
                    },
                    "balance": {
                      "type": "number"
                    }
                  }
                }
              }
            }
          },
          "lenderInformation": {
            "type": "object",
            "properties": {
              "lenderRef": {
                "type": "string"
              },
              "sortCode": {
                "type": "number"
              },
              "name": {
                "type": "string"
              },
              "lenderApplicationReference": {
                "type": "string"
              }
            }
          },
          "applicationDetails": {
            "type": "object",
            "properties": {
              "legalForm": {
                "type": "string",
                "enum": [
                  "Sole Trader",
                  "Partnership",
                  "Limited Liability Partnership (LLP)",
                  "Private Limited Company (LTD)",
                  "Public Limited Company (PLC)",
                  "Other"
                ]
              },
              "companyRegistrationNumber": {
                "type": "string"
              },
              "businessLegalName": {
                "type": "string"
              },
              "businessTradingName": {
                "type": "string"
              },
              "sicCode": {
                "$ref": "../models/objectPointer.v1.json"
              },
              "companyTurnover": {
                "type": "number"
              },
              "tradingActivityTurnoverGreaterThanAllowed": {
                "type": "boolean"
              },
              "tradingStartDate": {
                "type": "string",
                "format": "date"
              },
              "tradingPostcode": {
                "type": "string"
              }
            }
          },
          "predictedDrawDowns": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/drawDown"
            }
          },
          "drawDownEvents": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/drawDown"
            }
          },
          "repaymentHolidays": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "startDate": {
                  "type": "string",
                  "format": "date"
                },
                "endDate": {
                  "type": "string",
                  "format": "date"
                },
                "numberOfMonths": {
                  "type": "integer"
                }
              }
            }
          },
          "stateAid": {
            "type": "object",
            "properties": {
              "calculatedAmount": {
                "type": "number"
              },
              "underStateAidLimit": {
                "type": "boolean"
              }
            }
          },
          "currentStatus": {
            "type": "string",
            "default": "ineligible",
            "enum": [
              "ineligible",
              "eligible",
              "offered",
              "auto_cancelled",
              "guaranteed",
              "lender_demand",
              "repaid",
              "auto_removed",
              "removed",
              "noclaim"
            ]
          },
          "statusHistory": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "from": {
                  "type": "string"
                },
                "to": {
                  "type": "string"
                },
                "transitionDate": {
                  "type": "string",
                  "format": "date-time"
                },
                "by": {
                  "type": "string"
                }
              }
            }
          },
          "security": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "principalTypeOfAsset": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string",
                      "enum": [
                        "Residential Property other than a principal private residence",
                        "Commercial Property",
                        "Shares and other securities",
                        "Cash on deposit",
                        "Plant, machinery or other business equipment",
                        "Raw materials or stock",
                        "Personal vehicle, boat or other asset",
                        "Personal life insurance or other policy",
                        "Debenture or Floating Charge",
                        "Personal Guarantee – Supported",
                        "Personal Guarantee – Unsupported",
                        "Other"
                      ]
                    },
                    "value": {
                      "type": "number"
                    }
                  }
                }
              }
            }
          },
          "fees": {
            "type": "object",
            "properties": {
              "totalFees": {
                "type": "number"
              }
            }
          },
          "dataProtection": {
            "type": "object",
            "properties": {
              "dataProtectionAgreed": {
                "type": "boolean"
              }
            }
          },
          "additionalLenderInformation": {
            "type": "object",
            "properties": {
              "Information": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "applicationComplete": {
            "type": "object",
            "properties": {
              "completedDate": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "applicationOffered": {
            "type": "object",
            "properties": {
              "offeredDate": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "applicationGuaranteed": {
            "type": "object",
            "properties": {
              "guaranteedDate": {
                "type": "string",
                "format": "date-time"
              },
              "signedInformationDeclaration": {
                "type": "boolean"
              },
              "guaranteeFeePaymentCanBeMade": {
                "type": "boolean"
              }
            }
          }
        }
      }
    },
    "securitySchemes": {
      "Bearer token": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  },
  "tags": [
    {
      "name": "Guarantees"
    },
    {
      "name": "Demands"
    }
  ]
}