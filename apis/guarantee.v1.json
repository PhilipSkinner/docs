{
  "openapi": "3.0.0",
  "info": {
    "title": "Guarantees API",
    "version": "1.0",
    "contact": {
      "name": "Philip Skinner",
      "email": "philip.skinner@cds.co.uk"
    },
    "description": "Manages the lifecycle of guarantees."
  },
  "servers": [
    {
      "url": "http://localhost:3000"
    }
  ],
  "paths": {
    "/guarantees": {
      "parameters": [],
      "get": {
        "summary": "Get guarantees",
        "tags": [
          "Guarantees"
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "meta": {
                      "$ref": "../models/paginationMeta.v1.json"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/guaranteeResponse"
                      }
                    },
                    "links": {
                      "$ref": "../models/paginationLinks.v1.json"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "operationId": "get-lender-lenderId-guarantees",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "startdate"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "enddate"
          }
        ],
        "description": "Fetches a paginated list of guarantees.\n\nRequires the guarantee_reader role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ]
      },
      "post": {
        "summary": "Create a guarantee",
        "operationId": "post-lender-lenderId-guarantees",
        "responses": {
          "201": {
            "description": "Created",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              },
              "Location": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "tags": [
          "Guarantees"
        ],
        "description": "Creates a guarantee.\n\nRequires the guarantee_writer role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/guaranteeAttributes"
              }
            }
          }
        }
      }
    },
    "/guarantees/{guaranteeId}": {
      "parameters": [
        {
          "schema": {
            "type": "string"
          },
          "name": "guaranteeId",
          "in": "path",
          "required": true
        }
      ],
      "get": {
        "summary": "Get a guarantee",
        "tags": [
          "Guarantees"
        ],
        "responses": {
          "200": {
            "description": "OK",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "304": {
            "description": "Not Modified"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "operationId": "get-lender-lenderId-guarantees-guaranteeId",
        "description": "Fetch a single guarantee.\n\nRequires the guarantee_reader role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ]
      },
      "put": {
        "summary": "Update guarantee",
        "operationId": "put-lender-lenderId-guarantees-guaranteeId",
        "responses": {
          "202": {
            "description": "Accepted",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "description": "Update a guarantee.\n\nRequires the guarantee_writer role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/guaranteeAttributes"
              }
            }
          }
        },
        "tags": [
          "Guarantees"
        ]
      },
      "patch": {
        "summary": "Partially update a guarantee",
        "operationId": "patch-lender-lenderId-guarantees-guaranteeId",
        "responses": {
          "202": {
            "description": "Accepted",
            "headers": {
              "Etag": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/guarantee"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "422": {
            "description": "Unprocessable Entity",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "description": "Update a guarantee only with the values provided in the body.\n\nRequires the guarantee_writer role to access.",
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/guaranteeAttributes"
              }
            }
          }
        },
        "tags": [
          "Guarantees"
        ]
      },
      "delete": {
        "summary": "Delete a guarantee",
        "operationId": "delete-lender-lenderId-guarantees-guaranteeId",
        "responses": {
          "204": {
            "description": "No Content"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../models/errorResponse.v1.json"
                }
              }
            }
          }
        },
        "description": "Delete a guarantee.\n\nRequires the guarantee_remover role to access.",
        "tags": [
          "Guarantees"
        ],
        "security": [
          {
            "Bearer token": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "X-idempotency-key"
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "header",
            "name": "If-match"
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "guarantee": {
        "title": "guarantee",
        "type": "object",
        "x-tags": [
          "Misc Models"
        ],
        "properties": {
          "meta": {
            "$ref": "../models/individualMeta.v1.json"
          },
          "data": {
            "$ref": "#/components/schemas/guaranteeResponse"
          },
          "links": {
            "type": "object",
            "properties": {
              "self": {
                "type": "string",
                "format": "uri"
              }
            }
          },
          "errors": {
            "type": "array",
            "items": {
              "$ref": "../models/error.v1.json"
            }
          }
        }
      },
      "guaranteeResponse": {
        "title": "guaranteeResponse",
        "type": "object",
        "x-tags": [
          "Misc Models"
        ],
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "type": {
            "type": "string",
            "enum": [
              "guarantee"
            ]
          },
          "etag": {
            "type": "string"
          },
          "attributes": {
            "$ref": "#/components/schemas/guaranteeAttributes"
          }
        }
      },
      "guaranteeAttributes": {
        "title": "guaranteeAttributes",
        "type": "object",
        "x-tags": [
          "Guarantees"
        ],
        "description": "",
        "properties": {
          "createdBy": {
            "type": "string",
            "description": "Not to be sent in POST/PUT/PATCH."
          },
          "createdDate": {
            "type": "string",
            "format": "date-time",
            "description": "Not to be sent in POST/PUT/PATCH."
          },
          "updatedBy": {
            "type": "string",
            "description": "Not to be sent in POST/PUT/PATCH."
          },
          "updatedDate": {
            "type": "string",
            "format": "date-time",
            "description": "Not to be sent in POST/PUT/PATCH."
          },
          "dataProtectionAgreed": {
            "$ref": "#/components/schemas/booleanAnswer"
          },
          "facilityDetails": {
            "type": "object",
            "properties": {
              "assetFinanceDetails": {
                "type": "object",
                "properties": {
                  "balloonAmount": {
                    "$ref": "#/components/schemas/integerAnswer"
                  },
                  "details": {
                    "type": "object",
                    "properties": {
                      "category": {
                        "$ref": "#/components/schemas/stringAnswer"
                      },
                      "cashPrice": {
                        "$ref": "../models/objectPointer.v1.json"
                      },
                      "installCost": {
                        "$ref": "#/components/schemas/integerAnswer"
                      },
                      "deposit": {
                        "$ref": "#/components/schemas/integerAnswer"
                      },
                      "partExchange": {
                        "$ref": "#/components/schemas/integerAnswer"
                      },
                      "originalBalance": {
                        "$ref": "#/components/schemas/integerAnswer"
                      },
                      "residualValue": {
                        "$ref": "#/components/schemas/integerAnswer"
                      },
                      "coverPercent": {
                        "$ref": "#/components/schemas/numberAnswer"
                      },
                      "totalGuaranteesFacilityAmount": {
                        "$ref": "#/components/schemas/integerAnswer"
                      }
                    },
                    "required": [
                      "category",
                      "cashPrice",
                      "installCost",
                      "deposit",
                      "partExchange",
                      "residualValue",
                      "coverPercent"
                    ]
                  },
                  "agreementType": {
                    "$ref": "#/components/schemas/stringAnswer"
                  }
                }
              },
              "interest": {
                "type": "object",
                "properties": {
                  "type": {
                    "$ref": "#/components/schemas/stringAnswer"
                  },
                  "rateMargin": {
                    "$ref": "#/components/schemas/numberAnswer"
                  }
                }
              },
              "facilityTotalAmount": {
                "$ref": "#/components/schemas/integerAnswer"
              },
              "principalPurpose": {
                "$ref": "#/components/schemas/stringAnswer"
              },
              "repaymentType": {
                "type": "object",
                "properties": {
                  "paymentType": {
                    "$ref": "#/components/schemas/stringAnswer"
                  },
                  "fixedRepaymentAmount": {
                    "$ref": "#/components/schemas/integerAnswer"
                  },
                  "term": {
                    "type": "object",
                    "properties": {
                      "years": {
                        "$ref": "#/components/schemas/integerAnswer"
                      },
                      "months": {
                        "$ref": "#/components/schemas/integerAnswer"
                      }
                    }
                  },
                  "paymentFrequency": {
                    "$ref": "#/components/schemas/stringAnswer"
                  },
                  "seasonalMonths": {
                    "type": "array",
                    "items": {}
                  }
                }
              },
              "facilityType": {
                "$ref": "#/components/schemas/stringAnswer"
              },
              "product": {
                "$ref": "../models/objectPointer.v1.json"
              }
            }
          },
          "lender": {
            "$ref": "../models/objectPointer.v1.json"
          },
          "applicationDetails": {
            "type": "object",
            "properties": {
              "legalForm": {
                "$ref": "#/components/schemas/stringAnswer"
              },
              "companyRegistrationNumber": {
                "$ref": "#/components/schemas/stringAnswer"
              },
              "businessLegalName": {
                "$ref": "#/components/schemas/stringAnswer"
              },
              "businessTradingName": {
                "$ref": "#/components/schemas/stringAnswer"
              },
              "sicCode": {
                "$ref": "../models/objectPointer.v1.json"
              },
              "companyTurnover": {
                "$ref": "#/components/schemas/integerAnswer"
              },
              "turnoverAboveFiftyPercent": {
                "$ref": "#/components/schemas/booleanAnswer"
              },
              "tradingStartDate": {
                "$ref": "#/components/schemas/stringAnswer"
              },
              "tradingPostcode": {
                "$ref": "#/components/schemas/stringAnswer"
              },
              "bankAccount": {
                "$ref": "#/components/schemas/integerAnswer"
              },
              "bankSortCode": {
                "$ref": "#/components/schemas/integerAnswer"
              }
            }
          },
          "predictedDrawDowns": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/drawDown"
            }
          },
          "drawDowns": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/drawDown"
            }
          },
          "repaymentHolidays": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "startDate": {
                  "$ref": "#/components/schemas/dateAnswer"
                },
                "endDate": {
                  "$ref": "#/components/schemas/dateAnswer"
                }
              }
            }
          },
          "stateAid": {
            "type": "object",
            "properties": {
              "calculatedAmount": {
                "$ref": "#/components/schemas/integerAnswer"
              },
              "applicantMinimusStateAidPastThreeYears": {
                "$ref": "#/components/schemas/booleanAnswer"
              }
            }
          },
          "feesAndSecurity": {
            "type": "object",
            "properties": {
              "totalVaue": {
                "$ref": "#/components/schemas/integerAnswer"
              },
              "security": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "additionalSecurityValue": {
                      "$ref": "#/components/schemas/integerAnswer"
                    },
                    "principalTypeofAsset": {
                      "$ref": "#/components/schemas/integerAnswer"
                    }
                  }
                }
              }
            }
          },
          "currentStatus": {
            "type": "string"
          },
          "statusHistory": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "from": {
                  "type": "string"
                },
                "to": {
                  "type": "string"
                },
                "date": {
                  "type": "string",
                  "format": "date-time"
                },
                "by": {
                  "type": "string"
                }
              }
            }
          },
          "expectedRepayments": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "date": {
                  "$ref": "#/components/schemas/dateAnswer"
                },
                "amount": {
                  "$ref": "#/components/schemas/numberAnswer"
                },
                "balance": {
                  "$ref": "#/components/schemas/numberAnswer"
                }
              }
            }
          },
          "repayments": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "date": {
                  "$ref": "#/components/schemas/dateAnswer"
                },
                "amount": {
                  "$ref": "#/components/schemas/numberAnswer"
                },
                "balance": {
                  "$ref": "#/components/schemas/numberAnswer"
                }
              }
            }
          },
          "lenderSortCode": {
            "$ref": "#/components/schemas/numberAnswer"
          },
          "additionalSecurity": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "amount": {
                  "$ref": "#/components/schemas/numberAnswer"
                },
                "principalTypeOfAsset": {
                  "$ref": "#/components/schemas/stringAnswer"
                }
              }
            }
          },
          "documentsEnvelope": {
            "$ref": "../models/objectPointer.v1.json"
          },
          "feeSchedule": {
            "$ref": "../models/objectPointer.v1.json"
          }
        }
      },
      "drawDown": {
        "title": "drawDown",
        "type": "object",
        "properties": {
          "date": {
            "type": "string",
            "format": "date"
          },
          "amount": {
            "type": "integer"
          }
        },
        "required": [
          "date",
          "amount"
        ]
      },
      "booleanAnswer": {
        "title": "booleanAnswer",
        "type": "object",
        "properties": {
          "answer": {
            "type": "boolean"
          },
          "question": {
            "$ref": "#/components/schemas/question"
          }
        },
        "required": [
          "answer",
          "question"
        ]
      },
      "question": {
        "title": "question",
        "type": "object",
        "properties": {
          "questionText": {
            "type": "string",
            "description": "Text that was shown to the user to capture this information."
          },
          "relatedText": {
            "type": "string"
          }
        },
        "required": [
          "questionText"
        ]
      },
      "integerAnswer": {
        "title": "integerAnswer",
        "type": "object",
        "properties": {
          "answer": {
            "type": "integer"
          },
          "question": {
            "$ref": "#/components/schemas/question"
          }
        },
        "required": [
          "answer",
          "question"
        ]
      },
      "stringAnswer": {
        "title": "stringAnswer",
        "type": "object",
        "properties": {
          "answer": {
            "type": "string"
          },
          "question": {
            "$ref": "#/components/schemas/question"
          }
        },
        "required": [
          "answer",
          "question"
        ]
      },
      "dateAnswer": {
        "title": "dateAnswer",
        "type": "object",
        "properties": {
          "answer": {
            "type": "string",
            "format": "date-time"
          },
          "question": {
            "$ref": "#/components/schemas/question"
          }
        },
        "required": [
          "answer",
          "question"
        ]
      },
      "numberAnswer": {
        "title": "numberAnswer",
        "type": "object",
        "properties": {
          "answer": {
            "type": "number"
          },
          "question": {
            "$ref": "#/components/schemas/question"
          }
        },
        "required": [
          "answer",
          "question"
        ]
      }
    },
    "securitySchemes": {
      "Bearer token": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  },
  "tags": [
    {
      "name": "Guarantees"
    },
    {
      "name": "Demands"
    }
  ]
}